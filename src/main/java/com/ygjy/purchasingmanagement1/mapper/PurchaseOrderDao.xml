<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ygjy.purchasingmanagement1.dao.PurchaseOrderDao">
    <resultMap id="BaseResultMap" type="com.ygjy.purchasingmanagement1.pojo.PurchaseOrder">
        <id column="id" jdbcType="INTEGER" property="id" />
        <result column="purchase_order_number" jdbcType="INTEGER" property="purchaseOrderNumber" />
        <result column="name_of_purchase_order" jdbcType="VARCHAR" property="nameOfPurchaseOrder" />
        <result column="hospital_id" jdbcType="INTEGER" property="hospitalId" />
        <result column="contacts" jdbcType="VARCHAR" property="contacts" />
        <result column="phone" jdbcType="VARCHAR" property="phone" />
        <result column="create_receipts_time" jdbcType="VARCHAR" property="createReceiptsTime" />
        <result column="last_modification_time" jdbcType="VARCHAR" property="lastModificationTime" />
        <result column="submission_time" jdbcType="VARCHAR" property="submissionTime" />
        <result column="remark" jdbcType="VARCHAR" property="remark" />
        <result column="purchase_state" jdbcType="VARCHAR" property="purchaseState" />
        <result column="audit_person" jdbcType="VARCHAR" property="auditPerson" />
        <result column="audit_opinion" jdbcType="VARCHAR" property="auditOpinion" />
        <result column="audit_time" jdbcType="VARCHAR" property="auditTime" />
        <result column="del_state" jdbcType="VARCHAR" property="delState" />
        <result column="hospital_name" jdbcType="VARCHAR" property="hospitalName" />
    </resultMap>
    <sql id="Base_Column_List">
    id, purchase_order_number, name_of_purchase_order, hospital_id, contacts, phone,create_receipts_time,
    last_modification_time, submission_time,remark,purchase_state,audit_person,audit_opinion,audit_time,del_state
  </sql>
    <!-- 查询所有 -->
    <select id="selectPurchaseOrder" resultMap="BaseResultMap">
        select * from purchase_order where del_state = 0
    </select>
    <!--模糊查询-->
    <select id="selectItemsLike" resultMap="BaseResultMap">
        select * from drug_items
        <where>
            <if test="drugItemsNumber!=null and drugItemsNumber!=''">
                and drug_items_number like CONCAT ('%',#{drugItemsNumber},'%')
            </if>
            <if test="commonName!=null and commonName!=''">
                and common_name like CONCAT ('%',#{commonName},'%')
            </if>
            <if test="dosageFormId!=null and dosageFormId!= 0">
                and dosage_form_id like CONCAT ('%',#{dosageFormId},'%')
            </if>
            <if test="specification!=null and specification!=''">
                and specification like CONCAT ('%',#{specification},'%')
            </if>
            <if test="unit!=null and unit!=''">
                and unit like CONCAT ('%',#{unit},'%')
            </if>
            <if test="conversionFraction!=null and conversionFraction!=''">
                and conversion_fraction like CONCAT ('%',#{conversionFraction},'%')
            </if>
            <if test="drugCategoryId!=null and drugCategoryId!=0 ">
                and drug_category_id like CONCAT ('%',#{drugCategoryId},'%')
            </if>
            <if test="state!=null and state!='' ">
                and state like CONCAT ('%',#{state},'%')
            </if>
        </where>
    </select>

    <!--插入-->
    <insert id="addPurchaseOrder" parameterType="com.ygjy.purchasingmanagement1.pojo.PurchaseOrder">
        insert into purchase_order(purchase_order_number,common_name,dosage_form_id,specification,
        unit,conversion_fraction,drug_category_id,state)values
        (#{drugItemsNumber},#{commonName},#{dosageFormId},#{specification},#{unit},#{conversionFraction},
        #{drugCategoryId},#{state})
    </insert>
    <!--采购单号查询-->
    <select id="selectOne" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        select purchase_order.id, purchase_order_number, name_of_purchase_order, hospital_id, contacts, phone,create_receipts_time,
    last_modification_time, submission_time,remark,purchase_state,audit_person,audit_opinion,audit_time,del_state, hospital_name
    from purchase_order ,hospital where purchase_order.hospital_id = hospital.id
    and purchase_order.id = #{id,jdbcType=INTEGER}
    </select>
    <!--修改药品-->
    <update id="updatePurchaseOrder" parameterType="com.ygjy.purchasingmanagement1.pojo.PurchaseOrder">
        update purchase_order p,hospital h  set p.hospital_id = #{hospitalId},
        h.hospital_name = #{hospitalName}, purchase_order_number = #{purchaseOrderNumber}, name_of_purchase_order = #{nameOfPurchaseOrder},
        contacts = #{contacts},phone = #{phone},create_receipts_time= #{createReceiptsTime},last_modification_time = #{lastModificationTime},
        submission_time = #{submissionTime},remark = #{remark},purchase_state = #{purchaseState},audit_person = #{auditPerson},
        audit_opinion = #{auditOpinion},audit_time = #{auditTime}
    where p.hospital_id = h.id
    and p.id = #{id}
    </update>
    <!--删除-->
    <update id="deletePurchaseOrder" parameterType="java.lang.Integer">
        update purchase_order set del_state = 1 where id=#{id}
    </update>
</mapper>