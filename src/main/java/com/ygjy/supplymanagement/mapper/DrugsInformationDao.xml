<?xml version="1.0" encoding="UTF-8" ?>
        <!DOCTYPE mapper
                PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
                "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ygjy.supplymanagement.dao.DrugsInformationDao">
    <resultMap id="BaseResultMap" type="com.ygjy.supplymanagement.pojo.DrugInformation">
        <id column="iid" jdbcType="INTEGER" property="id" />
        <result column="serial_number" jdbcType="VARCHAR" property="serialNumber" />
        <result column="common_name" jdbcType="VARCHAR" property="commonName" />
        <result column="dosage_form_id" jdbcType="INTEGER" property="dosageFormId" />
        <result column="specification" jdbcType="VARCHAR" property="specification" />
        <result column="conversion_fraction" jdbcType="VARCHAR" property="conversionFraction" />
        <result column="enterprise_name_id" jdbcType="VARCHAR" property="enterpriseNameId" />
        <result column="trade_name" jdbcType="VARCHAR" property="tradeName" />
        <result column="bidding_price" jdbcType="REAL" property="biddingPrice" />
        <result column="unit" jdbcType="VARCHAR" property="unit" />
        <result column="common_name_pinyin" jdbcType="VARCHAR" property="commonNamePinyin" />
        <result column="product_picture" jdbcType="VARCHAR" property="productPicture" />
        <result column="approval_number" jdbcType="VARCHAR" property="approvalNumber" />
        <result column="validity_of_approval_number" jdbcType="VARCHAR" property="validityOfApprovalNumber" />
        <result column="imported_drug" jdbcType="INTEGER" property="importedDrug" />
        <result column="packaging_material" jdbcType="VARCHAR" property="packagingMaterial" />
        <result column="packing_unit" jdbcType="VARCHAR" property="packingUnit" />
        <result column="latest_retail_price" jdbcType="REAL" property="latestRetailPrice" />
        <result column="source_of_retail_price" jdbcType="VARCHAR" property="sourceOfRetailPrice" />
        <result column="quality_level_id" jdbcType="INTEGER" property="qualityLevelId" />
        <result column="quality_level_description" jdbcType="VARCHAR" property="qualityLevelDescription" />
        <result column="drug_inspection_report" jdbcType="INTEGER" property="drugInspectionReport" />
        <result column="drug_inspection_report_number" jdbcType="VARCHAR" property="drugInspectionReportNumber" />
        <result column="validity_of_drug_inspection_report" jdbcType="DATE" property="validityOfDrugInspectionReport" />
        <result column="description_of_products" jdbcType="VARCHAR" property="descriptionOfProducts" />
        <result column="drug_category_id" jdbcType="INTEGER" property="drugCategoryId" />
        <result column="drug_transaction_status_id" jdbcType="INTEGER" property="drugTransactionStatusId" />
        <result column="del_state" jdbcType="INTEGER" property="delState" />
        <result column="audit_status" jdbcType="INTEGER" property="auditStatus" />
        <association property="durgsFrom" javaType="com.ygjy.supplymanagement.pojo.DurgsFrom">
            <id column="durg_from_id" jdbcType="INTEGER" property="durgFromId" />
            <result column="drug_from" jdbcType="VARCHAR" property="drugFrom" />
            <result column="note" jdbcType="VARCHAR" property="note" />
        </association>
        <association property="drugTransactionStatus" javaType="com.ygjy.supplymanagement.pojo.DrugTransactionStatus">
            <id column="sid" jdbcType="INTEGER" property="id" />
            <result column="drug_transaction_status" jdbcType="VARCHAR" property="drugTransactionStatus" />
            <result column="drug_transaction_explain" jdbcType="VARCHAR" property="drugTransactionExplain" />
        </association>
        <association property="drugCategory" javaType="com.ygjy.supplymanagement.pojo.DrugCategory">
            <id column="drugCateGoryId" property="drug_category_Id" jdbcType="INTEGER" />
            <result column="drug_category_name" property="drugCategoryName" jdbcType="VARCHAR" />
        </association>
        <association property="qualityLevel" javaType="com.ygjy.supplymanagement.pojo.QualityLevel">
            <id column="qua_id" jdbcType="INTEGER" property="quaId" />
            <result column="level" jdbcType="VARCHAR" property="level" />
        </association>
        <association property="enterprise" javaType="com.ygjy.supplymanagement.pojo.Enterprise">
            <id column="eid" jdbcType="INTEGER" property="id" />
            <result column="enterprise_name" jdbcType="VARCHAR" property="enterpriseName" />
            <result column="enterprise_type" jdbcType="VARCHAR" property="enterpriseType" />
            <result column="license" jdbcType="VARCHAR" property="license" />
            <result column="license_expiration_date" jdbcType="DATE" property="licenseExpirationDate" />
            <result column="enterprise_contacts" jdbcType="VARCHAR" property="enterpriseContacts" />
            <result column="enterprise_telephone" jdbcType="VARCHAR" property="enterpriseTelephone" />
            <result column="business_scope" jdbcType="VARCHAR" property="businessScope" />
            <result column="registered_address" jdbcType="VARCHAR" property="registeredAddress" />
            <result column="contact_address" jdbcType="VARCHAR" property="contactAddress" />
            <result column="postal_Code" jdbcType="VARCHAR" property="postalCode" />
            <result column="total_assets" jdbcType="REAL" property="totalAssets" />
            <result column="corporate_fax" jdbcType="VARCHAR" property="corporateFax" />
            <result column="legal_person" jdbcType="VARCHAR" property="legalPerson" />
            <result column="legal_person_id_card" jdbcType="VARCHAR" property="legalPersonIdCard" />
            <result column="enterprise_registered_capital" jdbcType="REAL" property="enterpriseRegisteredCapital" />
            <result column="sales_amount_last_year" jdbcType="REAL" property="salesAmountLastYear" />
            <result column="email" jdbcType="VARCHAR" property="email" />
            <result column="website" jdbcType="VARCHAR" property="website" />
            <result column="enterprise_code" jdbcType="VARCHAR" property="enterpriseCode" />
            <result column="enterprise_code_date" jdbcType="DATE" property="enterpriseCodeDate" />
            <result column="business_license" jdbcType="VARCHAR" property="businessLicense" />
            <result column="business_license _date" jdbcType="DATE" property="businessLicenseDate" />
            <result column="enterprise_letter_of_credit" jdbcType="INTEGER" property="enterpriseLetterOfCredit" />
            <result column="enterprise_letter_number" jdbcType="VARCHAR" property="enterpriseLetterNumber" />
            <result column="enterprise_letter_data" jdbcType="DATE" property="enterpriseLetterData" />
            <result column="fixed_assets" jdbcType="REAL" property="fixedAssets" />
            <result column="company_profile" jdbcType="VARCHAR" property="companyProfile" />
            <result column="remark" jdbcType="VARCHAR" property="remark" />
            <result column="del_state" jdbcType="INTEGER" property="delState" />
        </association>
        <association property="enterpriseDrugCatalog" javaType="com.ygjy.supplymanagement.pojo.EnterpriseDrugCatalog">
            <id column="fid" jdbcType="INTEGER" property="id" />
            <result column="enterprise_id" jdbcType="INTEGER" property="enterpriseId" />
            <result column="drug_information_id" jdbcType="INTEGER" property="drugInformationId" />
        </association>
        <association property="suppliers" javaType="com.ygjy.supplymanagement.pojo.Suppliers">
            <id column="suppliers_id" jdbcType="INTEGER" property="suppliersid" />
            <result column="supplier_name" jdbcType="INTEGER" property="suppliername" />
        </association>
    </resultMap>
    <resultMap id="BaseResultMap2" type="com.ygjy.supplymanagement.pojo.DurgsFrom">
        <id column="durg_from_id" jdbcType="INTEGER" property="durgFromId" />
        <result column="drug_from" jdbcType="VARCHAR" property="drugFrom" />
        <result column="note" jdbcType="VARCHAR" property="note" />
    </resultMap>
    <resultMap id="BaseResultMap3" type="com.ygjy.supplymanagement.pojo.DrugCategory">
        <id column="drug_category_Id" property="drugCateGoryId" jdbcType="INTEGER" />
        <result column="drug_category_name" property="drugCategoryName" jdbcType="VARCHAR" />
    </resultMap>
    <resultMap id="BaseResultMap4" type="com.ygjy.supplymanagement.pojo.DrugTransactionStatus">
        <id column="id" jdbcType="INTEGER" property="id" />
        <result column="drug_transaction_status" jdbcType="VARCHAR" property="drugTransactionStatus" />
        <result column="drug_transaction_explain" jdbcType="VARCHAR" property="drugTransactionExplain" />
    </resultMap>
    <resultMap id="BaseResultMap5" type="com.ygjy.supplymanagement.pojo.QualityLevel">
        <id column="qua_id" jdbcType="INTEGER" property="quaId" />
        <result column="level" jdbcType="VARCHAR" property="level" />
    </resultMap>
    <resultMap id="BaseResultMap6" type="com.ygjy.supplymanagement.pojo.Enterprise">
        <id column="id" jdbcType="INTEGER" property="id" />
        <result column="enterprise_name" jdbcType="VARCHAR" property="enterpriseName" />
    </resultMap>
    <resultMap id="BaseResultMap7" type="com.ygjy.supplymanagement.pojo.EnterpriseDrugCatalog">
        <id column="id" jdbcType="INTEGER" property="id" />
        <result column="enterprise_id" jdbcType="INTEGER" property="enterpriseId" />
        <result column="drug_information_id" jdbcType="INTEGER" property="drugInformationId" />
    </resultMap>
    <resultMap id="BaseResultMap8" type="com.ygjy.supplymanagement.pojo.Suppliers">
        <id column="suppliers_id" jdbcType="INTEGER" property="suppliersid" />
        <result column="supplier_name" jdbcType="INTEGER" property="suppliername" />
    </resultMap>
    <sql id="Base_Column_List">
    i.serial_number, i.common_name, i.dosage_form_id, i.specification, i.conversion_fraction,
    i.enterprise_name_id, i.trade_name, i.bidding_price, i.unit, i.common_name_pinyin,i. product_picture,
    i.approval_number, i.validity_of_approval_number, i.imported_drug, i.packaging_material,
    i.packing_unit, i.latest_retail_price, i.source_of_retail_price, i.quality_level_id,i.quality_level_description,
    i.drug_inspection_report, i.drug_inspection_report_number, i.validity_of_drug_inspection_report,
    i.description_of_products, i.drug_category_id, i.drug_transaction_status_id, i.del_state,i.audit_status,i.`audit_status`
  </sql>
    <!--药品品目模糊查询及全部查询-->
    <select id="getQuery" resultMap="BaseResultMap">
        SELECT
        i.`id` AS iid ,c.`drug_category_Id` AS cid,s.`id` AS sid,e.`id` AS eid,d.`drug_from`,d.`note`,c.`drug_category_Id`,c.`drug_category_name`,s.`drug_transaction_explain`,s.`drug_transaction_status` ,d.`durg_from_id`,l.`qua_id`,l.`level`,e.enterprise_name,
        <include refid="Base_Column_List" />
        FROM drug_information i
        LEFT JOIN durgs_from d ON d.`durg_from_id`=i.`dosage_form_id`
        LEFT JOIN drug_category c ON c.`drug_category_Id`=i.`drug_category_id`
        LEFT JOIN drug_transaction_status s ON s.`id`=i.`drug_transaction_status_id`
        LEFT JOIN quality_level l ON l.`qua_id`=i.`quality_level_id`
        LEFT JOIN enterprise e ON e.`id`=i.`enterprise_name_id`
        WHERE i.`del_state`=0
            <if test="commonName != null and commonName != ''">
                and common_name like CONCAT('%',#{commonName,jdbcType=VARCHAR},'%')
            </if>
            <if test="serialNumber != null and serialNumber != ''">
                and serial_number like CONCAT('%',#{serialNumber,jdbcType=VARCHAR},'%')
            </if>
            <if test="dosageFormId != null">
                and d.`durg_from_id` like CONCAT('%',#{dosageFormId,jdbcType=INTEGER},'%')
            </if>
            <if test="specification != null and specification != ''">
                and specification like CONCAT('%',#{specification,jdbcType=VARCHAR},'%')
            </if>
            <if test="unit != null and unit != ''">
                and unit like CONCAT('%',#{unit,jdbcType=VARCHAR},'%')
            </if>
            <if test="conversionFraction != null and conversionFraction != ''">
                and conversion_fraction like CONCAT('%',#{conversionFraction,jdbcType=VARCHAR},'%')
            </if>
            <if test="drugCategoryId != null">
                and c.`drug_category_id` like CONCAT('%',#{drugCategoryId,jdbcType=INTEGER},'%')
            </if>
            <if test="drugTransactionStatusId != null">
                and `drug_transaction_status_id` like CONCAT('%',#{drugTransactionStatusId,jdbcType=INTEGER},'%')
            </if>
        <if test="enterpriseNameId != null">
            and `enterprise_name_id` like CONCAT('%',#{enterpriseNameId,jdbcType=INTEGER},'%')
        </if>
        <if test="tradeName != null and tradeName != ''">
            and `trade_name` like CONCAT('%',#{tradeName,jdbcType=VARCHAR},'%')
        </if>
        <if test="latestRetailPrice != null">
            and `latest_retail_price` like CONCAT('%',#{latestRetailPrice,jdbcType=REAL},'%')
        </if>
        <if test="qualityLevelId != null">
            and `quality_level_id` like CONCAT('%',#{qualityLevelId,jdbcType=INTEGER},'%')
        </if>
    </select>
    <!--条件查询-->
    <select id="getSelect" resultMap="BaseResultMap" parameterType="java.lang.Integer">
  SELECT
        i.`id` AS iid ,c.`drug_category_Id` AS cid,s.`id` AS sid,e.`id` AS eid,d.`drug_from`,d.`note`,c.`drug_category_name`,s.`drug_transaction_explain`,s.`drug_transaction_status` ,d.`durg_from_id`,l.`qua_id`,l.`level`,e.enterprise_name,r.`suppliers_id`,r.`supplier_name`,
        <include refid="Base_Column_List" />
        FROM drug_information i
        LEFT JOIN durgs_from d ON d.`durg_from_id`=i.`dosage_form_id`
        LEFT JOIN drug_category c ON c.`drug_category_Id`=i.`drug_category_id`
        LEFT JOIN drug_transaction_status s ON s.`id`=i.`drug_transaction_status_id`
        LEFT JOIN quality_level l ON l.`qua_id`=i.`quality_level_id`
        LEFT JOIN enterprise e ON e.`id`=i.`enterprise_name_id`
        LEFT JOIN suppliers r ON r.`suppliers_id`=e.`suppliers_id`
        where i.`del_state`=0 and i.`id` = #{id,jdbcType=INTEGER}
    </select>
    <!--剂型表查询-->
    <select id="selectDurgsFrom" resultMap="BaseResultMap2">
        SELECT * FROM durgs_from
    </select>
    <!--药品类别表查询-->
    <select id="selectDrugCategory" resultMap="BaseResultMap3">
         SELECT * FROM drug_category
    </select>
    <!--药品交易状态表查询-->
    <select id="selectDrugTransactionStatus" resultMap="BaseResultMap4">
         SELECT * FROM drug_transaction_status
    </select>
    <!--质量层次-->
    <select id="qualityLevel" resultMap="BaseResultMap5">
         SELECT * FROM quality_level
    </select>
    <!--企业-->
    <select id="enterPrise" resultMap="BaseResultMap6">
        SELECT id,enterprise_name FROM enterprise
    </select>
    <!--导出-->
    <select id="importselect" resultMap="BaseResultMap">
        SELECT
        i.`id` AS iid ,c.`drug_category_Id` AS cid,s.`id` AS sid,e.`id` AS eid,d.`drug_from`,d.`note`,c.`drug_category_name`,s.`drug_transaction_explain`,s.`drug_transaction_status` ,d.`durg_from_id`,l.`qua_id`,l.`level`,e.enterprise_name,r.`supplier_name`,
        <include refid="Base_Column_List" />
        FROM drug_information i
        LEFT JOIN durgs_from d ON d.`durg_from_id`=i.`dosage_form_id`
        LEFT JOIN drug_category c ON c.`drug_category_Id`=i.`drug_category_id`
        LEFT JOIN drug_transaction_status s ON s.`id`=i.`drug_transaction_status_id`
        LEFT JOIN quality_level l ON l.`qua_id`=i.`quality_level_id`
        LEFT JOIN enterprise e ON e.`id`=i.`enterprise_name_id`
        LEFT JOIN suppliers r ON r.`suppliers_id`=e.`suppliers_id`
        where i.`id` in
        <foreach collection="array" item="items" open="(" separator="," close=")">
            #{items}
        </foreach>
    </select>
    <!--选择供货-->
    <insert id="insertSelective" parameterType="com.ygjy.pojo.EnterpriseDrugCatalog">
        insert into enterprise_drug_catalog
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="enterpriseId != null">
                enterprise_id,
            </if>
            <if test="drugInformationId != null">
                drug_information_id,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>
            <if test="enterpriseId != null">
                #{enterpriseId,jdbcType=INTEGER},
            </if>
            <if test="drugInformationId != null">
                #{drugInformationId,jdbcType=INTEGER},
            </if>
        </trim>
    </insert>
    <!--供应商药品目录表查询-->
    <select id="selectEnterpriseDrugCatalog" resultMap="BaseResultMap7">
        SELECT * FROM enterprise_drug_catalog
    </select>
    <!--选择供货查询-->
    <select id="backSelect" resultMap="BaseResultMap">
        SELECT
        i.`id` AS iid ,e.`id` AS eid,e.enterprise_name,f.id AS fid,r.`suppliers_id`,r.`supplier_name`,
        <include refid="Base_Column_List" />
        FROM drug_information i
        INNER JOIN `enterprise_drug_catalog` f ON i.`id`=f.`drug_information_id`
        INNER JOIN enterprise e ON e.`id`=f.`enterprise_id`
        INNER JOIN suppliers r ON r.`suppliers_id`=e.`suppliers_id`
        <if test="commonName != null and commonName != ''">
            and common_name like CONCAT('%',#{commonName,jdbcType=VARCHAR},'%')
        </if>
        <if test="serialNumber != null and serialNumber != ''">
            and serial_number like CONCAT('%',#{serialNumber,jdbcType=VARCHAR},'%')
        </if>
        <if test="dosageFormId != null">
            and i.`durg_from_id` like CONCAT('%',#{dosageFormId,jdbcType=INTEGER},'%')
        </if>
        <if test="specification != null and specification != ''">
            and specification like CONCAT('%',#{specification,jdbcType=VARCHAR},'%')
        </if>
        <if test="unit != null and unit != ''">
            and unit like CONCAT('%',#{unit,jdbcType=VARCHAR},'%')
        </if>
        <if test="conversionFraction != null and conversionFraction != ''">
            and conversion_fraction like CONCAT('%',#{conversionFraction,jdbcType=VARCHAR},'%')
        </if>
        <if test="drugCategoryId != null">
            and `drug_category_id` like CONCAT('%',#{drugCategoryId,jdbcType=INTEGER},'%')
        </if>
        <if test="drugTransactionStatusId != null">
            and `drug_transaction_status_id` like CONCAT('%',#{drugTransactionStatusId,jdbcType=INTEGER},'%')
        </if>
        <if test="enterpriseNameId != null">
            and `enterprise_name_id` like CONCAT('%',#{enterpriseNameId,jdbcType=INTEGER},'%')
        </if>
        <if test="tradeName != null and tradeName != ''">
            and `trade_name` like CONCAT('%',#{tradeName,jdbcType=VARCHAR},'%')
        </if>
        <if test="latestRetailPrice != null">
            and `latest_retail_price` like CONCAT('%',#{latestRetailPrice,jdbcType=REAL},'%')
        </if>
        <if test="qualityLevelId != null">
            and `quality_level_id` like CONCAT('%',#{qualityLevelId,jdbcType=INTEGER},'%')
        </if>
        <if test="suppliersid != null">
            and r.`suppliers_id` like CONCAT('%',#{suppliersid,jdbcType=INTEGER},'%')
        </if>
        <if test="auditStatus != null" >
            and `audit_status` like CONCAT('%',#{auditStatus,jdbcType=INTEGER},'%')
        </if>
    </select>
    <!--取消供货批量删除 -->
    <delete id="falseDelete">
        DELETE FROM enterprise_drug_catalog where id in
        <foreach collection="array" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
    </delete>
    <!--供应商查询-->
    <select id="supplierSelect" resultMap="BaseResultMap8">
          SELECT*FROM suppliers
    </select>
    <!--修改商品信息维护-->
    <update id="updateByPrimaryKeySelectives" parameterType="com.ygjy.supplymanagement.pojo.DrugInformation">
    update drug_information
    <set>
    <if test="serialNumber != null">
        serial_number = #{serialNumber,jdbcType=VARCHAR},
    </if>
    <if test="commonName != null">
        common_name = #{commonName,jdbcType=VARCHAR},
    </if>
    <if test="dosageFormId != null">
        dosage_form_id = #{dosageFormId,jdbcType=INTEGER},
    </if>
    <if test="specification != null">
        specification = #{specification,jdbcType=VARCHAR},
    </if>
    <if test="conversionFraction != null">
        conversion_fraction = #{conversionFraction,jdbcType=VARCHAR},
    </if>
    <if test="enterpriseNameId != null">
        enterprise_name_id = #{enterpriseNameId,jdbcType=INTEGER},
    </if>
    <if test="tradeName != null">
        trade_name = #{tradeName,jdbcType=VARCHAR},
    </if>
    <if test="biddingPrice != null">
        bidding_price = #{biddingPrice,jdbcType=REAL},
    </if>
    <if test="unit != null">
        unit = #{unit,jdbcType=VARCHAR},
    </if>
    <if test="commonNamePinyin != null">
        common_name_pinyin = #{commonNamePinyin,jdbcType=VARCHAR},
    </if>
    <if test="productPicture != null">
        product_picture = #{productPicture,jdbcType=VARCHAR},
    </if>
    <if test="approvalNumber != null">
        approval_number = #{approvalNumber,jdbcType=VARCHAR},
    </if>
    <if test="validityOfApprovalNumber != null">
        validity_of_approval_number = #{validityOfApprovalNumber,jdbcType=VARCHAR},
    </if>
    <if test="importedDrug != null">
        imported_drug = #{importedDrug,jdbcType=INTEGER},
    </if>
    <if test="packagingMaterial != null">
        packaging_material = #{packagingMaterial,jdbcType=VARCHAR},
    </if>
    <if test="packingUnit != null">
        packing_unit = #{packingUnit,jdbcType=VARCHAR},
    </if>
    <if test="latestRetailPrice != null">
        latest_retail_price = #{latestRetailPrice,jdbcType=REAL},
    </if>
        <if test="sourceOfRetailPrice != null">
            source_of_retail_price = #{sourceOfRetailPrice,jdbcType=VARCHAR},
        </if>
        <if test="qualityLevelId != null">
            quality_level_id = #{qualityLevelId,jdbcType=INTEGER},
        </if>
        <if test="qualityLevelDescription != null">
            quality_level_description = #{qualityLevelDescription,jdbcType=VARCHAR},
        </if>
        <if test="drugInspectionReport != null">
            drug_inspection_report = #{drugInspectionReport,jdbcType=INTEGER},
        </if>
        <if test="drugInspectionReportNumber != null">
            drug_inspection_report_number = #{drugInspectionReportNumber,jdbcType=VARCHAR},
        </if>
        <if test="validityOfDrugInspectionReport != null">
            validity_of_drug_inspection_report = #{validityOfDrugInspectionReport,jdbcType=DATE},
        </if>
        <if test="descriptionOfProducts != null">
            description_of_products = #{descriptionOfProducts,jdbcType=VARCHAR},
        </if>
        <if test="drugCategoryId != null">
            drug_category_id = #{drugCategoryId,jdbcType=INTEGER},
        </if>
        <if test="drugTransactionStatusId != null">
            drug_transaction_status_id = #{drugTransactionStatusId,jdbcType=INTEGER},
        </if>
        <if test="delState != null">
            del_state = #{delState,jdbcType=INTEGER},
        </if>
        <if test="auditStatus != null">
            audit_status = #{auditStatus,jdbcType=INTEGER},
        </if>
    </set>
        where id = #{id,jdbcType=INTEGER}
    </update>

</mapper>